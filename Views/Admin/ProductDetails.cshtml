@model WebShop.Models.Product
@{
    ViewData["Title"] = "Product Details";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>@Model.Name</h2>
<div class="card">
    <div class="card-body">
        @if (!string.IsNullOrEmpty(Model.ImagePath))
        {
            <img src="@Model.ImagePath" alt="@Model.Name" style="max-width: 300px;" />
        }
        <p><strong>Category:</strong> @Model.Category.Name</p>
        <p><strong>Brand:</strong> @Model.Brand.Name</p>
        <p><strong>Price:</strong> @Model.Price</p>
        @if (Model.OldPrice.HasValue)
        {
            <p><strong>Old Price:</strong> <span class="text-muted text-decoration-line-through">@Model.OldPrice</span></p>
        }
        @{
            var averageRating = Model.Reviews.Any() ? Model.Reviews.Average(r => r.Rating) : 0;
            var reviewCount = Model.Reviews.Count;
        }
        <p><strong>Stock:</strong> @Model.Stock</p>
        <p><strong>Featured:</strong> @(Model.Featured ? "Yes" : "No")</p>
        <p><strong>averageRating:</strong> @averageRating</p>
        <p><strong>ReviewCount:</strong> @reviewCount</p>
        <p><strong>Description:</strong> @Model.Description</p>
        <a asp-action="EditProduct" asp-route-id="@Model.Id" class="btn btn-warning">Edit</a>
        <a asp-action="Products" class="btn btn-secondary">Back to Products</a>
    </div>
</div>

<h3>Reviews</h3>
@if (Model.Reviews.Any())
{
    <div class="list-group">
        @foreach (var review in Model.Reviews.OrderByDescending(r => r.CreatedAt))
        {
            <div class="list-group-item">
                <p><strong>@review.User.FullName</strong> (@review.CreatedAt.ToString("dd/MM/yyyy")) - @review.Rating Stars</p>
                <p>@review.Comment</p>
            </div>
        }
    </div>
}
else
{
    <p>No reviews yet.</p>
}

<h3>Chat Messages</h3>
@if (Model.ChatMessages.Any())
{
    <div class="list-group">
        @foreach (var message in Model.ChatMessages.OrderByDescending(cm => cm.CreatedAt))
        {
            <div class="list-group-item">
                <p><strong>@(message.IsAdminReply ? "Admin" : message.User.FullName)</strong> (@message.CreatedAt.ToString("dd/MM/yyyy HH:mm"))</p>
                <p>@message.Message</p>
            </div>
        }
    </div>
}
else
{
    <p>No messages yet.</p>
}